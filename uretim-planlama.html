<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dijital Sipari≈ü K√∂pr√ºs√º</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="sidebar">
    <div class="logo">Y√∂netim Paneli</div>

    <div class="panel-secici">
      <button class="aktif">Fabrika</button>
      <button onclick="window.location.href='bayi-anasayfa.html'">Bayi</button>
    </div>

    <ul>
      <li><a href="panel-fabrika.html">Ana Sayfa</a></li>
      <li><a href="bayi-yonetimi.html">Bayi Y√∂netimi</a></li>
      <li><a href="siparis-yonetimi.html">Sipari≈ü Y√∂netimi</a></li>
      <li><a class="aktif" href="uretim-planlama.html">√úretim Planlama</a></li>
      <li><a href="hammadde-yonetimi.html">Hammadde Y√∂netimi</a></li>
    </ul>

    <div class="footer">¬© 2025 Y√∂netim Sistemi</div>
  </div>

  <div class="main-content">

    <header>
      <div>
        <h1>Fabrika Y√∂netim Paneli</h1>
        <p>√úretim Planlama</p>
      </div>
      <div class="kullanici-bilgisi">
        Y√∂netici
        <span>10 Kasƒ±m 2025 Pazartesi</span>
      </div>
    </header>

    <div class="sayfa-basligi">
      <div>
        <h2>√úretim Planlama</h2>
        <p>Aktif √ºretim emirlerini y√∂netin ve optimize edin</p>
      </div>
    </div>

    <div class="kart-grid">
      <div class="info-card purple">
        <span class="kart-baslik">Aktif √úretim Emirleri</span>
        <span class="kart-deger">4</span>
      </div>
      <div class="info-card green">
        <span class="kart-baslik">Tamamlanan √úretimler</span>
        <span class="kart-deger">1</span>
      </div>
      <div class="info-card blue">
        <span class="kart-baslik">Toplam √úretim (Bu Ay)</span>
        <span class="kart-deger">750</span>
      </div>
      <div class="info-card orange">
        <span class="kart-baslik">Ortalama Verimlilik</span>
        <span class="kart-deger">%78</span>
        <span class="kart-trend">Son 30 g√ºn</span>
      </div>
    </div>

    <div class="tab-list" style="margin-top: 24px; width: auto;">
      <button class="tab-button aktif" data-target="tab-uretim">Aktif √úretim Emirleri</button>
    </div>

    <div id="tab-uretim" class="tab-content aktif">
      <div class="tablo-container">
        <h3>Aktif √úretim Emirleri</h3>
        <table id="uretim-tablosu">
          <thead>
            <tr>
              <th>Emir No</th>
              <th>√úr√ºn</th>
              <th>Miktar</th>
              <th>ƒ∞lerleme</th>
              <th>Ba≈ülangƒ±√ß</th>
              <th>Biti≈ü</th>
              <th>Kalan G√ºn</th>
              <th>Durum</th>
              <th>ƒ∞≈ülemler</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- üîπ Modal -->
  <div id="siparisDetayModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h3>Sipari≈ü Detaylarƒ±</h3>
      <p><strong>Emir No:</strong> <span id="detayEmirNo"></span></p>
      <p><strong>√úr√ºn:</strong> <span id="detayUrun"></span></p>
      <p><strong>Miktar:</strong> <span id="detayMiktar"></span></p>
      <p><strong>ƒ∞lerleme:</strong> <span id="detayIlerleme"></span></p>
      <p><strong>Ba≈ülangƒ±√ß:</strong> <span id="detayBaslangic"></span></p>
      <p><strong>Biti≈ü:</strong> <span id="detayBitis"></span></p>
      <p><strong>Durum:</strong> <span id="detayDurum"></span></p>

      <div style="margin-top: 16px; text-align: right;">
        <button id="btnTamamla" class="btn-onayla">Tamamlandƒ±</button>
        <button id="btnBeklemede" class="btn-beklemede">Beklemede</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="main.js"></script>

  <!-- üîπ G√ºncellenmi≈ü √ºretim.js -->
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabloBody = document.querySelector("#uretim-tablosu tbody");
    const modal = document.getElementById("siparisDetayModal");
    const closeBtn = document.querySelector(".close-btn");

    if (!tabloBody || !modal) {
      console.error("‚ùå Tablo veya modal bulunamadƒ±!");
      return;
    }

    async function uretimListesiniGetir() {
      let data = [];
      try {
        const res = await fetch("http://localhost:3000/uretim");
        if (!res.ok) throw new Error("Backend eri≈üimi ba≈üarƒ±sƒ±z.");
        data = await res.json();
      } catch (err) {
        console.warn("‚ö†Ô∏è Backend baƒülantƒ±sƒ± ba≈üarƒ±sƒ±z, √∂rnek veriyle devam ediliyor.");
        data = [
          {
            siparis_id: "√úE-001",
            urun_adi: "G√ºl Parf√ºm√º",
            miktar: "350 / 500",
            ilerleme: 70,
            baslangic_tarihi: "2025-11-05",
            bitis_tarihi: "2025-11-12",
            durum: "√úretimde"
          },
          {
            siparis_id: "√úE-004",
            urun_adi: "Papatya √ñz√º",
            miktar: "0 / 400",
            ilerleme: 0,
            baslangic_tarihi: "2025-11-09",
            bitis_tarihi: "2025-11-16",
            durum: "Beklemede"
          }
        ];
      }

      tabloBody.innerHTML = "";
      if (!data || data.length === 0) {
        tabloBody.innerHTML = `<tr><td colspan="9" style="text-align:center;">≈ûu anda √ºretimde sipari≈ü bulunmuyor.</td></tr>`;
        return;
      }

      data.forEach(kayit => {
        const baslangic = new Date(kayit.baslangic_tarihi).toLocaleDateString("tr-TR");
        const bitis = new Date(kayit.bitis_tarihi).toLocaleDateString("tr-TR");

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${kayit.siparis_id}</td>
          <td>${kayit.urun_adi}</td>
          <td>${kayit.miktar}</td>
          <td>
            <div class="progress-bar">
              <div class="progress-bar-inner" style="width:${kayit.ilerleme}%;">${kayit.ilerleme}%</div>
            </div>
          </td>
          <td>${baslangic}</td>
          <td>${bitis}</td>
          <td>7 g√ºn</td>
          <td><span class="badge ${kayit.durum === "Beklemede" ? "onay-bekliyor" : "uretimde"}">${kayit.durum}</span></td>
          <td>
            <button class="btn-detay" data-id="${kayit.siparis_id}">Detay</button>
          </td>
        `;
        tabloBody.appendChild(tr);
      });

      // üîπ ‚ÄúDetay‚Äù tƒ±klama
      tabloBody.querySelectorAll(".btn-detay").forEach(btn => {
        btn.addEventListener("click", () => {
          const siparisId = btn.dataset.id;
          const siparis = data.find(k => k.siparis_id === siparisId);
          if (!siparis) return;

          document.getElementById("detayEmirNo").textContent = siparis.siparis_id;
          document.getElementById("detayUrun").textContent = siparis.urun_adi;
          document.getElementById("detayMiktar").textContent = siparis.miktar;
          document.getElementById("detayIlerleme").textContent = `${siparis.ilerleme}%`;
          document.getElementById("detayBaslangic").textContent = siparis.baslangic_tarihi;
          document.getElementById("detayBitis").textContent = siparis.bitis_tarihi;
          document.getElementById("detayDurum").textContent = siparis.durum;

          modal.style.display = "flex";
        });
      });
    }

    closeBtn.addEventListener("click", () => (modal.style.display = "none"));
    window.addEventListener("click", e => {
      if (e.target === modal) modal.style.display = "none";
    });

    uretimListesiniGetir();
  });
  </script>
</body>
</html>

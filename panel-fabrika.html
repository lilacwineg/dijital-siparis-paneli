<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dijital SipariÅŸ KÃ¶prÃ¼sÃ¼</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<style>
  .bayi-aktivitesi-table {
  
    border-radius: 12px;

    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .bayi-aktivitesi-table:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  }

  .bayi-aktivitesi-table h3 {
    margin: 0 0 20px 0;
    font-size: 18px;
    font-weight: 600;
    
  }

  .bayi-aktivitesi-table canvas {
    
  }
</style>
  <div class="sidebar">
    <div class="logo">YÃ¶netim Paneli</div>

    <div class="panel-secici">
      <button class="aktif">Fabrika</button>
      <button onclick="window.location.href='bayi-anasayfa.html'">Bayi</button>
    </div>

    <ul>
      <li><a class="aktif" href="panel-fabrika.html">Ana Sayfa</a></li> 
      <li><a href="bayi-yonetimi.html">Bayi YÃ¶netimi</a></li>
      <li><a href="siparis-yonetimi.html">SipariÅŸ YÃ¶netimi</a></li>
      <li><a href="uretim-planlama.html">Ãœretim Planlama</a></li>
      <li><a href="hammadde-yonetimi.html">Hammadde YÃ¶netimi</a></li>
    </ul>

    <div class="footer">
      Â© 2025 YÃ¶netim Sistemi
    </div>
  </div> <div class="main-content">
    
    <header>
      <div>
        <h1>Fabrika YÃ¶netim Paneli</h1>
        <p>Ana Sayfa</p>
      </div>
      <div class="kullanici-bilgisi">
        YÃ¶netici
        <span>17 KasÄ±m 2025 Pazar</span>
      </div>
    </header>

    <div class="sayfa-basligi">
      <div>
        <h2>HoÅŸ Geldiniz</h2>
        <p>Genel durumu ve performans metriklerini buradan takip edebilirsiniz</p>
      </div>
    </div>

    <div class="kart-grid">
      <div class="info-card purple">
        <span class="kart-baslik">Toplam SipariÅŸ</span>
        <span class="kart-deger"></span>
      </div>
      <div class="info-card blue">
        <span class="kart-baslik">Aktif Bayiler</span>
        <span class="kart-deger"></span>
      </div>
      <div class="info-card red">
        <span class="kart-baslik">Kritik Stoklar</span>
        <span class="kart-deger"></span>
      </div>
      <div class="info-card green">
        <span class="kart-baslik">Sevkiyat Durumu</span>
        <span class="kart-deger"></span>
      </div>
    </div>

    <div class="grafik-grid">
      <div class="chart-card">
        <h3>Åžehir BazlÄ± SipariÅŸ DaÄŸÄ±lÄ±mÄ±</h3>
        <canvas id="sehirBazliGrafik"></canvas>
      </div>
      <div class="chart-card">
        <h3>AylÄ±k SatÄ±ÅŸ Trendleri</h3>
        <canvas id="aylikSatisGrafik"></canvas>
      </div>
      <div class="chart-card">
        <h3>SipariÅŸ Durumu</h3>
        <canvas id="sevkiyatDurumGrafik"></canvas>
      </div>


  <div class="chart-card bayi-aktivitesi-table">
    <h3>Bayi Aktivitesi (Top 5)</h3>
    <canvas id="bayiChart"></canvas>
  </div>
    </div>
    
  </div> <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
  <script src="main.js"></script> 
  <script src="fabrika-anasayfa.js"></script>
  <script>
 async function loadTopBayiler() {
    try {
      const response = await fetch('http://localhost:3000/fabrika/top-bayiler');
      const data = await response.json();

      const labels = data.map(bayi => bayi.bayi_adi);
      const siparisler = data.map(bayi => bayi.siparis_sayisi);

      renderBayiChart(labels, siparisler);

    } catch (error) {
      console.error('Veri Ã§ekme hatasÄ±:', error);
    }
  }

  function renderBayiChart(labels, siparisler) {
    const ctx = document.getElementById('bayiChart');

    // Chart.js'in kendi destroy metodu
    if (Chart.getChart('bayiChart')) {
      Chart.getChart('bayiChart').destroy();
    }

    // Gradient oluÅŸtur
    const gradient1 = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
    gradient1.addColorStop(0, 'rgba(99, 102, 241, 0.8)');
    gradient1.addColorStop(1, 'rgba(99, 102, 241, 0.2)');

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels.map(label => label.length > 25 ? label.substring(0, 25) + '...' : label),
        datasets: [
          {
            label: 'SipariÅŸ SayÄ±sÄ±',
            data: siparisler,
            backgroundColor: gradient1,
            borderColor: 'rgba(99, 102, 241, 1)',
            borderWidth: 2,
            borderRadius: 8,
            borderSkipped: false
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
          mode: 'index',
          intersect: false,
        },
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              padding: 15,
              font: {
                size: 12,
                weight: '500'
              },
              usePointStyle: true,
              pointStyle: 'circle'
            }
          },
          title: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleFont: {
              size: 14,
              weight: 'bold'
            },
            bodyFont: {
              size: 13
            },
            cornerRadius: 8,
            displayColors: true,
            callbacks: {
              label: function(context) {
                return 'SipariÅŸ SayÄ±sÄ±: ' + context.parsed.y + ' sipariÅŸ';
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            },
            ticks: {
              font: {
                size: 11
              },
              maxRotation: 45,
              minRotation: 45
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              stepSize: 1,
              font: {
                size: 11
              }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            }
          }
        },
        animation: {
          duration: 1500,
          easing: 'easeInOutQuart'
        }
      }
    });
  }


  // 2ï¸âƒ£ SÄ°PARÄ°Åž DURUM
  async function loadSiparisDurum() {
    try {
      const response = await fetch('http://localhost:3000/fabrika/siparis-durum');
      const data = await response.json();

      const labels = data.map(item => item.durum);
      const values = data.map(item => item.adet);

      renderSiparisDurumChart(labels, values);

    } catch (error) {
      console.error('SipariÅŸ durum hatasÄ±:', error);
    }
  }

  function renderSiparisDurumChart(labels, values) {
    const ctx = document.getElementById('sevkiyatDurumGrafik');

    // Chart.js'in kendi destroy metodu
    if (Chart.getChart('sevkiyatDurumGrafik')) {
      Chart.getChart('sevkiyatDurumGrafik').destroy();
    }

    // KESIN FARKLI RENKLER - HER BÄ°RÄ° BELÄ°RGÄ°N
    const colors = labels.map(durum => {
      switch(durum) {
        case 'TamamlandÄ±':
        case 'Tamamlandi':
          return {
            bg: 'rgba(34, 197, 94, 0.85)',      // ðŸŸ¢ PARLAK YEÅžÄ°L
            border: 'rgba(34, 197, 94, 1)'
          };
        case 'Sevkiyatta':
          return {
            bg: 'rgba(20, 184, 166, 0.85)',     // ðŸŸ¦ TURKUAZ
            border: 'rgba(20, 184, 166, 1)'
          };
        case 'Ãœretimde':
          return {
            bg: 'rgba(59, 130, 246, 0.85)',     // ðŸ”µ PARLAK MAVÄ°
            border: 'rgba(59, 130, 246, 1)'
          };
        case 'Onay Bekliyor':
          return {
            bg: 'rgba(251, 146, 60, 0.85)',     // ðŸŸ  PARLAK TURUNCU
            border: 'rgba(251, 146, 60, 1)'
          };
        case 'OnaylandÄ±':
          return {
            bg: 'rgba(234, 179, 8, 0.85)',      // ðŸŸ¡ SARI
            border: 'rgba(234, 179, 8, 1)'
          };
        case 'Beklemede':
          return {
            bg: 'rgba(148, 163, 184, 0.85)',    // âšª GRÄ°
            border: 'rgba(148, 163, 184, 1)'
          };
        case 'Ä°ptal':
        case 'Iptal':
          return {
            bg: 'rgba(239, 68, 68, 0.85)',      // ðŸ”´ KIRMIZI
            border: 'rgba(239, 68, 68, 1)'
          };
        default:
          return {
            bg: 'rgba(168, 85, 247, 0.85)',     // ðŸŸ£ MOR
            border: 'rgba(168, 85, 247, 1)'
          };
      }
    });

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          data: values,
          backgroundColor: colors.map(c => c.bg),
          borderColor: colors.map(c => c.border),
          borderWidth: 2,
          hoverOffset: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 10,
              font: {
                size: 11,
                weight: '500'
              },
              color: '#ffffff',
              usePointStyle: true,
              pointStyle: 'circle',
              generateLabels: function(chart) {
                const data = chart.data;
                if (data.labels.length && data.datasets.length) {
                  return data.labels.map((label, i) => {
                    const value = data.datasets[0].data[i];
                    return {
                      text: `${label} (${value})`,
                      fillStyle: data.datasets[0].backgroundColor[i],
                      strokeStyle: data.datasets[0].borderColor[i],
                      fontColor: '#ffffff',
                      lineWidth: 2,
                      hidden: false,
                      index: i
                    };
                  });
                }
                return [];
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleFont: {
              size: 14,
              weight: 'bold'
            },
            bodyFont: {
              size: 13
            },
            cornerRadius: 8,
            callbacks: {
              label: function(context) {
                const label = context.label || '';
                const value = context.parsed;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percentage = ((value / total) * 100).toFixed(1);
                return `${label}: ${value} sipariÅŸ (${percentage}%)`;
              }
            }
          }
        },
        animation: {
          animateRotate: true,
          animateScale: true,
          duration: 1500,
          easing: 'easeInOutQuart'
        },
        cutout: '65%'
      }
    });
  }

  // 3ï¸âƒ£ SAYFA YÃœKLENDÄ°ÄžÄ°NDE Ã‡AÄžIR
  window.addEventListener('DOMContentLoaded', () => {
    loadTopBayiler();
    loadSiparisDurum();
  });

  </script>
</body>
</html>